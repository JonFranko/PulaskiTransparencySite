<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request Meeting Recordings - Pulaski Township Transparency</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>Pulaski Township Transparency Project</h1>
            <p>Request Your Own Copies</p>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="index.html#meetings">Meeting Archive</a></li>
            <li><a href="request.html">Request Recordings</a></li>
            <li><a href="index.html#about">About</a></li>
            <li><a href="index.html#contact">Contact</a></li>
        </ul>
    </nav>

    <main class="container">
        <section id="intro">
            <h2>Request Meeting Recordings</h2>
            <p>Pennsylvania's Right-to-Know Law gives you the right to request public records, including meeting recordings. This tool fills out the official PA Right-to-Know form with your information.</p>
            
            <div class="info-box">
                <p><strong>How it works:</strong></p>
                <ol>
                    <li>Fill out your contact information below</li>
                    <li>Select which meeting recording you want</li>
                    <li>Click "Generate Official RTK Form"</li>
                    <li>Your completed form downloads automatically</li>
                    <li>Email as attachment or print, sign, and mail</li>
                </ol>
            </div>
        </section>

        <section id="request-form">
            <h2>Generate Your Request</h2>
            
            <form id="rtkForm" onsubmit="generateForm(event)">
                <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <h3>Your Contact Information</h3>
                    
                    <div style="margin-bottom: 1rem;">
                        <label for="fullName">Full Name *</label>
                        <input type="text" id="fullName" required>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label for="email">Email Address *</label>
                        <input type="email" id="email" required>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label for="address">Mailing Address *</label>
                        <input type="text" id="address" required>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label for="city">City *</label>
                            <input type="text" id="city" value="Pulaski" required>
                        </div>
                        <div>
                            <label for="state">State *</label>
                            <input type="text" id="state" value="PA" maxlength="2" required>
                        </div>
                        <div>
                            <label for="zip">ZIP *</label>
                            <input type="text" id="zip" value="16143" required>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label for="phone">Phone Number (optional)</label>
                        <input type="tel" id="phone">
                    </div>
                    
                    <hr style="margin: 2rem 0;">
                    
                    <h3>Which Meeting Recording?</h3>
                    
                    <div style="margin-bottom: 1rem;">
                        <label for="meetingDate">Meeting Date *</label>
                        <select id="meetingDate" required>
                            <option value="">-- Select a meeting --</option>
                            <option value="December 2025">December 2025</option>
                            <option value="November 2025">November 2025</option>
                            <option value="October 2025">October 2025</option>
                            <option value="September 2025">September 2025</option>
                            <option value="August 2025">August 2025</option>
                            <option value="July 2025">July 2025</option>
                            <option value="June 2025">June 2025</option>
                            <option value="April 2025">April 2025</option>
                            <option value="March 2025">March 2025</option>
                            <option value="February 2025">February 2025</option>
                        </select>
                    </div>
                    
                    <div class="warning-box" style="margin-top: 2rem;">
                        <p><strong>Important:</strong> This generates the official Pennsylvania Right-to-Know form. The township has 5 business days to respond.</p>
                    </div>
                    
                    <button type="submit" id="generateBtn"
                            style="width: 100%; background-color: var(--secondary-color); color: white; padding: 1.25rem 2rem; font-size: 1.2rem; font-weight: 600; border: none; border-radius: 4px; cursor: pointer; margin-top: 1.5rem;">
                        üìÑ Generate Official RTK Form
                    </button>
                    
                    <div id="statusMessage" style="margin-top: 1rem; padding: 1rem; border-radius: 4px; display: none;"></div>
                </div>
            </form>
        </section>

        <section id="after-download" style="margin-top: 3rem; display: none;">
            <h2>‚úÖ Your Official Form is Ready!</h2>
            
            <div class="info-box">
                <h3>Next Steps - Choose One:</h3>
                
                <div style="background: white; padding: 1.5rem; border-radius: 4px; margin: 1.5rem 0; border-left: 4px solid #059669;">
                    <h4>üìß Option 1: Email (Fastest - Recommended)</h4>
                    <ol>
                        <li>Open your email application</li>
                        <li>Create new email to township (verify email with (724) 253-2300)</li>
                        <li>Attach the PDF you just downloaded</li>
                        <li>Subject: "Right-to-Know Request"</li>
                        <li>Click Send</li>
                    </ol>
                </div>
                
                <div style="background: white; padding: 1.5rem; border-radius: 4px; margin: 1.5rem 0; border-left: 4px solid var(--secondary-color);">
                    <h4>üì¶ Option 2: Mail</h4>
                    <ol>
                        <li>Print the PDF</li>
                        <li>Sign the form</li>
                        <li>Mail to: <strong>Pulaski Township, 3478 Perry Highway, Hadley, PA 16130</strong></li>
                    </ol>
                </div>
                
                <p><strong>Response time:</strong> Township must respond within 5 business days.</p>
            </div>
        </section>

        <section id="faq" style="margin-top: 3rem;">
            <h2>Frequently Asked Questions</h2>
            
            <button class="collapsible">Is this the official PA form?</button>
            <div class="content">
                <div class="content-inner">
                    <p>Yes! This tool fills out the official Pennsylvania Office of Open Records Right-to-Know request form. It's the same form you'd download from openrecords.pa.gov.</p>
                </div>
            </div>
            
            <button class="collapsible">Do I have to pay for the recording?</button>
            <div class="content">
                <div class="content-inner">
                    <p>The form requests electronic delivery via email, which typically has minimal to no cost. The township must provide an estimate if fees apply.</p>
                </div>
            </div>
            
            <button class="collapsible">How long does it take?</button>
            <div class="content">
                <div class="content-inner">
                    <p>By law, the township has 5 business days to respond. They must either provide the record, deny with reason, or notify you they need more time (up to 30 days total).</p>
                </div>
            </div>
            
            <button class="collapsible">What if my request is denied?</button>
            <div class="content">
                <div class="content-inner">
                    <p>Meeting recordings are public records. If denied, you can appeal to the PA Office of Open Records within 15 business days. Contact jon@doubletreeindustries.com for help.</p>
                </div>
            </div>
            
            <button class="collapsible">Is my information stored?</button>
            <div class="content">
                <div class="content-inner">
                    <p>No. Your information is only used to fill the PDF form, which is then sent to your browser. Nothing is stored on our servers.</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Pulaski Township Transparency Project</p>
            <p>Official PA Right-to-Know form provided as a public service.</p>
        </div>
    </footer>

    <script>
        async function generateForm(event) {
            event.preventDefault();
            
            const btn = document.getElementById('generateBtn');
            const statusDiv = document.getElementById('statusMessage');
            
            // Disable button
            btn.disabled = true;
            btn.textContent = '‚è≥ Generating official form...';
            
            // Show loading status
            statusDiv.style.display = 'block';
            statusDiv.style.backgroundColor = '#e0f2fe';
            statusDiv.style.border = '1px solid #0ea5e9';
            statusDiv.style.color = '#0c4a6e';
            statusDiv.textContent = 'Filling out official PA RTK form...';
            
            try {
                // Collect form data
                const formData = {
                    fullName: document.getElementById('fullName').value,
                    email: document.getElementById('email').value,
                    address: document.getElementById('address').value,
                    city: document.getElementById('city').value,
                    state: document.getElementById('state').value,
                    zip: document.getElementById('zip').value,
                    phone: document.getElementById('phone').value,
                    meetingDate: document.getElementById('meetingDate').value
                };
                
                // Call the Cloudflare Worker
                const response = await fetch('/api/fill-rtk', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }
                
                // Get the PDF
                const blob = await response.blob();
                
                // Create download link
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                
                // Get filename from header or create one
                const disposition = response.headers.get('Content-Disposition');
                let filename = 'RTK_Request.pdf';
                if (disposition) {
                    const match = disposition.match(/filename="?([^"]+)"?/);
                    if (match) filename = match[1];
                }
                link.download = filename;
                
                // Download
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                // Success
                statusDiv.style.backgroundColor = '#d1fae5';
                statusDiv.style.border = '1px solid #059669';
                statusDiv.style.color = '#065f46';
                statusDiv.innerHTML = '<strong>‚úÖ Success!</strong> Official RTK form downloaded. Check your Downloads folder.';
                
                // Show next steps
                document.getElementById('after-download').style.display = 'block';
                document.getElementById('after-download').scrollIntoView({ behavior: 'smooth' });
                
                // Reset button
                setTimeout(() => {
                    btn.disabled = false;
                    btn.textContent = 'üìÑ Generate Official RTK Form';
                }, 2000);
                
            } catch (error) {
                console.error('Error:', error);
                statusDiv.style.backgroundColor = '#fee2e2';
                statusDiv.style.border = '1px solid #dc2626';
                statusDiv.style.color = '#991b1b';
                statusDiv.innerHTML = '<strong>‚ùå Error:</strong> Could not generate form. Please try again or contact jon@doubletreeindustries.com';
                
                btn.disabled = false;
                btn.textContent = 'üìÑ Try Again';
            }
        }
        
        // FAQ collapsible sections
        var coll = document.getElementsByClassName("collapsible");
        for (var i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
                this.classList.toggle("active");
                var content = this.nextElementSibling;
                if (content.style.maxHeight){
                    content.style.maxHeight = null;
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                }
            });
        }
    </script>
</body>
</html>
